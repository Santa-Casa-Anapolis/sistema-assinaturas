warning: in the working copy of 'client/src/utils/openPdf.js', LF will be replaced by CRLF the next time Git touches it
[1mdiff --git a/client/src/utils/openPdf.js b/client/src/utils/openPdf.js[m
[1mindex b6ef855..ca8c5d4 100644[m
[1m--- a/client/src/utils/openPdf.js[m
[1m+++ b/client/src/utils/openPdf.js[m
[36m@@ -1,59 +1,48 @@[m
[31m-import api from '../config/api';[m
[32m+[m[32mÔªøimport api from '../config/api';[m
 [m
 /**[m
[31m- * Abre um PDF em uma nova aba usando a rota de stream[m
[32m+[m[32m * Abre um PDF usando a rota de stream[m
  * @param {number} documentId - ID do documento[m
  */[m
 export const openPdf = async (documentId) => {[m
   try {[m
[31m-    console.log('üîç Abrindo PDF para documento ID:', documentId);[m
[31m-    [m
[31m-    // Verificar se h√° token[m
[32m+[m[32m    console.log('Abrindo PDF para documento ID:', documentId);[m
[32m+[m
     const token = localStorage.getItem('sa.token');[m
     if (!token) {[m
[31m-      throw new Error('Sem token de autentica√ß√£o');[m
[32m+[m[32m      throw new Error('Sem token de autenticacao');[m
     }[m
[31m-    [m
[31m-    // Fazer requisi√ß√£o para a rota de stream[m
[32m+[m
     const response = await api.get(`/documents/${documentId}/stream`, {[m
[31m-      responseType: 'blob'[m
[32m+[m[32m      responseType: 'blob',[m
     });[m
[31m-    [m
[31m-    console.log('‚úÖ PDF recebido via stream');[m
[31m-    [m
[31m-    // Criar blob URL[m
[32m+[m
     const blob = new Blob([response.data], { type: 'application/pdf' });[m
     const blobUrl = URL.createObjectURL(blob);[m
[31m-    [m
[31m-    console.log('üîó Blob URL criada:', blobUrl);[m
[31m-    [m
[31m-    // Abrir em nova aba[m
[31m-    const newWindow = window.open(blobUrl, '_blank', 'noopener,noreferrer');[m
[31m-    [m
[31m-    if (!newWindow) {[m
[31m-      throw new Error('Popup bloqueado pelo navegador');[m
[31m-    }[m
[31m-    [m
[31m-    // Limpar blob URL ap√≥s um tempo (opcional)[m
[31m-    setTimeout(() => {[m
[31m-      URL.revokeObjectURL(blobUrl);[m
[31m-      console.log('üßπ Blob URL limpa');[m
[31m-    }, 60000); // 1 minuto[m
[31m-    [m
[31m-    console.log('‚úÖ PDF aberto com sucesso');[m
[31m-    [m
[32m+[m
[32m+[m[32m    const link = document.createElement('a');[m
[32m+[m[32m    link.href = blobUrl;[m
[32m+[m[32m    link.target = '_blank';[m
[32m+[m[32m    link.rel = 'noopener noreferrer';[m
[32m+[m[32m    document.body.appendChild(link);[m
[32m+[m[32m    link.click();[m
[32m+[m[32m    link.remove();[m
[32m+[m
[32m+[m[32m    setTimeout(() => URL.revokeObjectURL(blobUrl), 60000);[m
   } catch (error) {[m
[31m-    console.error('‚ùå Erro ao abrir PDF:', error);[m
[31m-    [m
[32m+[m[32m    console.error('Erro ao abrir PDF:', error);[m
[32m+[m
     if (error.response?.status === 401) {[m
[31m-      throw new Error('Token de autentica√ß√£o inv√°lido');[m
[31m-    } else if (error.response?.status === 404) {[m
[31m-      throw new Error('Documento n√£o encontrado');[m
[31m-    } else if (error.response?.status === 403) {[m
[32m+[m[32m      throw new Error('Token de autenticacao invalido');[m
[32m+[m[32m    }[m
[32m+[m[32m    if (error.response?.status === 404) {[m
[32m+[m[32m      throw new Error('Documento nao encontrado');[m
[32m+[m[32m    }[m
[32m+[m[32m    if (error.response?.status === 403) {[m
       throw new Error('Acesso negado ao documento');[m
[31m-    } else {[m
[31m-      throw new Error(`Erro ao abrir PDF: ${error.message}`);[m
     }[m
[32m+[m
[32m+[m[32m    throw new Error(`Erro ao abrir PDF: ${error.message}`);[m
   }[m
 };[m
 [m
[36m@@ -63,53 +52,47 @@[m [mexport const openPdf = async (documentId) => {[m
  */[m
 export const openPdfWithFetch = async (documentId) => {[m
   try {[m
[31m-    console.log('üîç Abrindo PDF com fetch para documento ID:', documentId);[m
[31m-    [m
[32m+[m[32m    console.log('Abrindo PDF com fetch para documento ID:', documentId);[m
[32m+[m
     const token = localStorage.getItem('sa.token');[m
     if (!token) {[m
[31m-      throw new Error('Sem token de autentica√ß√£o');[m
[32m+[m[32m      throw new Error('Sem token de autenticacao');[m
     }[m
[31m-    [m
[32m+[m
     const response = await fetch(`/api/documents/${documentId}/stream`, {[m
       headers: {[m
[31m-        'Authorization': `Bearer ${token}`[m
[31m-      }[m
[32m+[m[32m        Authorization: `Bearer ${token}`,[m
[32m+[m[32m      },[m
     });[m
[31m-    [m
[32m+[m
     if (!response.ok) {[m
       if (response.status === 401) {[m
[31m-        throw new Error('Token de autentica√ß√£o inv√°lido');[m
[31m-      } else if (response.status === 404) {[m
[31m-        throw new Error('Documento n√£o encontrado');[m
[31m-      } else if (response.status === 403) {[m
[32m+[m[32m        throw new Error('Token de autenticacao invalido');[m
[32m+[m[32m      }[m
[32m+[m[32m      if (response.status === 404) {[m
[32m+[m[32m        throw new Error('Documento nao encontrado');[m
[32m+[m[32m      }[m
[32m+[m[32m      if (response.status === 403) {[m
         throw new Error('Acesso negado ao documento');[m
[31m-      } else {[m
[31m-        throw new Error(`Erro HTTP ${response.status}`);[m
       }[m
[32m+[m
[32m+[m[32m      throw new Error(`Erro HTTP ${response.status}`);[m
     }[m
[31m-    [m
[32m+[m
     const blob = await response.blob();[m
     const blobUrl = URL.createObjectURL(blob);[m
[31m-    [m
[31m-    console.log('üîó Blob URL criada via fetch:', blobUrl);[m
[31m-    [m
[31m-    // Abrir em nova aba[m
[31m-    const newWindow = window.open(blobUrl, '_blank', 'noopener,noreferrer');[m
[31m-    [m
[31m-    if (!newWindow) {[m
[31m-      throw new Error('Popup bloqueado pelo navegador');[m
[31m-    }[m
[31m-    [m
[31m-    // Limpar blob URL ap√≥s um tempo[m
[31m-    setTimeout(() => {[m
[31m-      URL.revokeObjectURL(blobUrl);[m
[31m-      console.log('üßπ Blob URL limpa');[m
[31m-    }, 60000);[m
[31m-    [m
[31m-    console.log('‚úÖ PDF aberto com sucesso via fetch');[m
[31m-    [m
[32m+[m
[32m+[m[32m    const link = document.createElement('a');[m
[32m+[m[32m    link.href = blobUrl;[m
[32m+[m[32m    link.target = '_blank';[m
[32m+[m[32m    link.rel = 'noopener noreferrer';[m
[32m+[m[32m    document.body.appendChild(link);[m
[32m+[m[32m    link.click();[m
[32m+[m[32m    link.remove();[m
[32m+[m
[32m+[m[32m    setTimeout(() => URL.revokeObjectURL(blobUrl), 60000);[m
   } catch (error) {[m
[31m-    console.error('‚ùå Erro ao abrir PDF com fetch:', error);[m
[32m+[m[32m    console.error('Erro ao abrir PDF com fetch:', error);[m
     throw error;[m
   }[m
[31m-};[m
\ No newline at end of file[m
[32m+[m[32m};[m
